# PyTwilio

Python FastAPI for sending text messages via Twilio

## Description
The PyTwilio Messaging API is reponsible for
1. Receiving requests to send messages via Twilio.
2. Sending requests to Twilio to send out the messages.


## How to setup the dev environment
1. Ensure python is installed
2. Clone this repo
3. Open a terminal in the root of this repo
4. Create a python virtual environment `python -m venv .venv`
5. Activate the virtual environment by running `.\.venv\Scripts\activate` on Windows. Or `source .venv/bin/activate` on Linux/Unix
6. Install dependencies `pip install -r requirements.txt`


## Twilio Integration

A Twilio Account is required for running this API

Create a file called `.env` in the project root with the following fields
```
TWILIO_ACCOUNT_SID=""
TWILIO_AUTH_TOKEN=""
TWILIO_MESSAGING_SERVICE_SID=""
```
Log into Twilio and get the secrets needed for your account. Paste them into the `.env`. This file is not tracked by git, so there is no worry about accidentally commiting these secrets to the repo.


All Twilio account secrets can be found by logging into the Twilio console.
1. TWILIO_ACCOUNT_SID and TWILIO_AUTH_TOKEN can be found by navigating to `account/keys-credentials/api-keys`
2. TWILIO_MESSAGING_SERVICE_SID can be found by navigating to `develop/sms/services`


## API Routes
Once the app is running (see below) you can navigate to http://127.0.0.1/8000/docs for the FastAPI autogenerated OpenAPI Docs
| Action | Route |
| ------ | ----- |
| Health | `GET /` |
| Docs   | `GET /docs` |
| Send Message | `POST /message` body: json (TwilioMessage object) |


## Running the API

### From the Terminal

Run `uvicorn app.main:app --reload`

### From VSCode Run and Debug
1. Create a `launch.json` file in the `.vscode` folder at the root of the repo
2. Update the `launch.json` with the following content. Note: if a launch.json already exists, you only need to add the configuration seen below to your existing `configurations` array
```
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python Debugger: PyTwilio FastAPI",
            "type": "debugpy",
            "request": "launch",
            "module": "uvicorn",
            "args": [
                "main:app",
                "--reload"
            ],
            "jinja": true
        }
    ]
}
```

## Running the Test Suite
1. Open a terminal in the root of this repo
2. Run pytest with code coverage `pytest tests/ --cov=app --cov-report term --cov-report html`

After the test run there will be a code coverage report printed to the console. There will also be an html report generated and placed in `{PROJECT_ROOT}/htmlcov` which can be viewed in a browser by opening the `{PROJECT_ROOT}/htmlcov/index.html`